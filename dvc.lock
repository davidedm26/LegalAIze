schema: '2.0'
stages:
  train:
    cmd: python train_model.py
    deps:
    - path: data/
      hash: md5
      md5: 6ffbaaad7b4ac6e1afabed19a80b2560.dir
      size: 0
      nfiles: 1
    - path: params.yaml
      hash: md5
      md5: 190181a863f1db18654d6e70e28e3e2c
      size: 135
    - path: train_model.py
      hash: md5
      md5: 154c4caeef74803e12241151c920014f
      size: 2804
    params:
      params.yaml:
        model:
          max_depth: 5
          n_estimators: 120
          random_state: 42
        train:
          test_size: 0.2
          random_state: 42
    outs:
    - path: metrics.json
      hash: md5
      md5: e53fffc12e23345b3fedebbd08b070b1
      size: 40
    - path: models/model.pkl
      hash: md5
      md5: 2c2c99e7ed9548fa2afc1a2d7bb8b90c
      size: 200977
  ingest:
    cmd: python data_ingestion.py
    deps:
    - path: data/ai_act.pdf
      hash: md5
      md5: a31da461b015738b42cc2f719a9acee4
      size: 2583319
    - path: data/iso.pdf
      hash: md5
      md5: 2ae5af2fc9eea16d8d0d3144b57ca428
      size: 2646955
    - path: data_ingestion.py
      hash: md5
      md5: 21f16f09f1fbe9ca3d8c8917c70f6051
      size: 3353
    - path: params.yaml
      hash: md5
      md5: dbfd6b262f15b2a1f0b6001e58134af7
      size: 1570
    params:
      params.yaml:
        ingestion:
          chunk_size: 1000
          chunk_overlap: 150
          raw_data_dir: data
          processed_data_dir: data/processed
    outs:
    - path: data/processed/chunks.json
      hash: md5
      md5: cce4bda3c0911e4591bb898e1f16481f
      size: 914485
  vectorize:
    cmd: python vectorize_data.py
    deps:
    - path: data/processed/chunks.json
      hash: md5
      md5: cce4bda3c0911e4591bb898e1f16481f
      size: 914485
    - path: params.yaml
      hash: md5
      md5: dbfd6b262f15b2a1f0b6001e58134af7
      size: 1570
    - path: vectorize_data.py
      hash: md5
      md5: 82537414d216486892ed40c699064ba2
      size: 3185
    params:
      params.yaml:
        vectorization:
          model_name: all-MiniLM-L6-v2
          collection_name: legal_docs
          qdrant_host: localhost
          qdrant_port: 6333
          vector_index_path: data/processed/vector_index
    outs:
    - path: data/processed/vector_index
      hash: md5
      md5: 7d22996f6e7b1ad57f0a766a02dcc818.dir
      size: 5136943
      nfiles: 4
  precompute_rag:
    cmd: python precompute_rag.py
    deps:
    - path: data/mapping.json
      hash: md5
      md5: 69351bcd3ca7db431ca50d43bd2a6820
      size: 13552
    - path: data/processed/vector_index
      hash: md5
      md5: 7d22996f6e7b1ad57f0a766a02dcc818.dir
      size: 5136943
      nfiles: 4
    - path: params.yaml
      hash: md5
      md5: dbfd6b262f15b2a1f0b6001e58134af7
      size: 1570
    - path: precompute_rag.py
      hash: md5
      md5: d1360c5a54108cc9cc96dd0397b2368d
      size: 4577
    params:
      params.yaml:
        ingestion:
          chunk_size: 1000
          chunk_overlap: 150
          raw_data_dir: data
          processed_data_dir: data/processed
        vectorization:
          model_name: all-MiniLM-L6-v2
          collection_name: legal_docs
          qdrant_host: localhost
          qdrant_port: 6333
          vector_index_path: data/processed/vector_index
    outs:
    - path: data/processed/requirement_chunks.json
      hash: md5
      md5: c404a5a9cb4cd0ac06ac4e66a29ee959
      size: 100375
  evaluate_rag:
    cmd: python evaluate_rag.py
    deps:
    - path: data/ground_truth/raw_data/Evaluation1/documentation.txt
      hash: md5
      md5: cb7a14d8bd9987a886e7e959fffe4bfc
      size: 5239
    - path: data/ground_truth/raw_data/Evaluation1/report.CSV
      hash: md5
      md5: 47bb23530f6741de60825ed7c1a1029a
      size: 2640
    - path: data/ground_truth/raw_data/Evaluation2/documentation.txt
      hash: md5
      md5: 700d11079b99b2c0c973fb804face8a1
      size: 3136
    - path: data/ground_truth/raw_data/Evaluation2/report.CSV
      hash: md5
      md5: 6af16851b9a9a7293699a90ce8879ceb
      size: 2655
    - path: data/processed/requirement_chunks.json
      hash: md5
      md5: c404a5a9cb4cd0ac06ac4e66a29ee959
      size: 100375
    - path: evaluate_rag.py
      hash: md5
      md5: 88dad98819d99f21c06676fbc883e199
      size: 15817
    - path: params.yaml
      hash: md5
      md5: dbfd6b262f15b2a1f0b6001e58134af7
      size: 1570
    params:
      params.yaml:
        evaluation:
          random_seed: 42
          llm_model: gpt-4o-mini
          llm_temperature: 0.1
          mlflow_experiment: rag_evaluation
          metrics_output: metrics/rag_eval.json
          case_selector: 4
          ground_truth:
          - name: Evaluation1
            document_path: 
              data/ground_truth/raw_data/Evaluation1/documentation.txt
            report_path: data/ground_truth/raw_data/Evaluation1/report.CSV
          - name: Evaluation2
            document_path: 
              data/ground_truth/raw_data/Evaluation2/documentation.txt
            report_path: data/ground_truth/raw_data/Evaluation2/report.CSV
          - name: Evaluation3
            document_path: 
              data/ground_truth/raw_data/Evaluation3/documentation.txt
            report_path: data/ground_truth/raw_data/Evaluation3/report.CSV
          - name: Evaluation4
            document_path: 
              data/ground_truth/raw_data/Evaluation4/documentation.txt
            report_path: data/ground_truth/raw_data/Evaluation4/report.CSV
    outs:
    - path: metrics/rag_eval.json
      hash: md5
      md5: 00fe6e976ae46d932c1969e8e3bb7db8
      size: 489
